-- ðŸŒ SQL Treino: FunÃ§Ãµes de AgregaÃ§Ã£o e Consultas com Filtros
-- Dataset: world
-- Objetivo: Praticar agregaÃ§Ãµes

-- Total da populaÃ§Ã£o mundial
SELECT SUM(population)
FROM world;

-- Lista de continentes Ãºnicos
SELECT DISTINCT continent
FROM world;

-- Soma do PIB (GNP) total da Ãfrica
SELECT SUM(gdp)
FROM world
WHERE continent = 'Africa';

-- NÃºmero de paÃ­ses com Ã¡rea maior ou igual a 1 milhÃ£o kmÂ²
SELECT COUNT(name)
FROM world
WHERE area >= 1000000;

-- Soma da populaÃ§Ã£o de paÃ­ses especÃ­ficos
SELECT SUM(population)
FROM world
WHERE name IN ('Germany', 'Cuba', 'France');

-- NÃºmero de paÃ­ses por continente (todos)
SELECT continent, COUNT(name)
FROM world
GROUP BY continent;

-- NÃºmero de paÃ­ses por continente com populaÃ§Ã£o â‰¥ 10 milhÃµes
SELECT continent, COUNT(name)
FROM world
WHERE population >= 10000000
GROUP BY continent;

-- Continentes com populaÃ§Ã£o total â‰¥ 100 milhÃµes
SELECT continent
FROM world 
GROUP BY continent
HAVING SUM(population) >= 100000000;

-- PaÃ­ses com populaÃ§Ã£o maior que a mÃ©dia de todos os continentes
SELECT name
FROM world
WHERE population > ALL(
    SELECT AVG(population) 
    FROM world
    GROUP BY continent
);

-- âš ï¸ Exemplo de erro comum: nÃ£o Ã© possÃ­vel usar COUNT em WHERE
-- O COUNT precisa ser usado no HAVING apÃ³s o GROUP BY
-- Por isso este cÃ³digo estÃ¡ incorreto:
-- SELECT continent, COUNT(continent) 
-- FROM world  
-- WHERE population > 1000000 AND COUNT(continent) > 5
-- GROUP BY continent;

-- Forma correta: filtro com COUNT deve ser feito no HAVING
SELECT continent, COUNT(continent) 
FROM world  
WHERE population > 1000000
GROUP BY continent
HAVING COUNT(continent) > 5;

-- 1ï¸âƒ£ PaÃ­ses com populaÃ§Ã£o entre 100M e 500M, ordenados pelos menos populosos
SELECT name, continent, population
FROM world
WHERE population BETWEEN 100000000 AND 500000000
ORDER BY population
LIMIT 5;

-- 2ï¸âƒ£ Continentes com ao menos 3 paÃ­ses com Ã¡rea conhecida
SELECT continent, COUNT(name) AS num_paises
FROM world
WHERE area IS NOT NULL
GROUP BY continent
HAVING COUNT(name) >=3;

-- 3ï¸âƒ£ PaÃ­ses com GNP maior que a mÃ©dia global
SELECT name, gdp
FROM world
WHERE gdp > (SELECT AVG(gdp) FROM world)
ORDER BY gdp DESC;

-- 4ï¸âƒ£ Continentes que tÃªm pelo menos um paÃ­s com populaÃ§Ã£o > 1 bilhÃ£o
SELECT DISTINCT continent
FROM world
WHERE population > 1000000000;

-- 5ï¸âƒ£ PaÃ­ses que NÃƒO estÃ£o nos 3 continentes mais populosos
SELECT name 
FROM world
WHERE continent NOT IN (
    SELECT continent
    FROM (
        SELECT continent
        FROM world
        GROUP BY continent
        ORDER BY SUM(population) DESC
        LIMIT 3
    ) AS top3
);

-- 6ï¸âƒ£ Top 5 paÃ­ses com maior GNP e Ã¡rea acima de 500.000 kmÂ²
SELECT name, ROUND(gdp/1000000) AS gdp, area
FROM world
WHERE area > 500000 AND gdp IS NOT NULL
ORDER BY gdp DESC
LIMIT 5;

-- 8ï¸âƒ£ 10 paÃ­ses mais populosos com GNP conhecido
SELECT name
FROM world
WHERE gdp IS NOT NULL AND population > 1000000 
ORDER BY population DESC
LIMIT 10;

-- 9ï¸âƒ£ Continentes cuja mÃ©dia de Ã¡rea estÃ¡ entre 300.000 e 700.000 kmÂ²
SELECT continent
FROM world
GROUP BY continent
HAVING AVG(area) BETWEEN 300000 AND 700000;

-- ðŸ”Ÿ PaÃ­s mais populoso de cada continente com GNP conhecido
SELECT continent, name, population
FROM world x
WHERE population >= ALL (
    SELECT population
    FROM world y
    WHERE y.continent = x.continent AND gdp IS NOT NULL
);
